# ğŸ“˜ Overview

This repository provides a production-ready OpenLDAP environment designed for authentication and directory services within the Punctiq ecosystem.  
It includes a custom Docker image based on Ubuntu 22.04, preconfigured with:

- OpenLDAP and ldap-utils
- Secure bind configuration and bootstrap entrypoint
- Persistent data and configuration volumes
- Runtime secrets injection via Docker volumes
- Optional environment variable overrides

The setup is intended for internal identity services and application integration (e.g., DevOps, monitoring, access control).

---

# ğŸ“¦ Project Structure

```
.
â”œâ”€â”€ Dockerfile                # Ubuntu base image with OpenLDAP and utils
â”œâ”€â”€ docker-compose.yml       # Deployment with persistent named volumes
â”œâ”€â”€ bootstrap/entrypoint.sh  # Bootstrap/init script for LDAP server
â”œâ”€â”€ secrets/                 # Secure location for password injection
â”œâ”€â”€ .env                     # LDAP configuration (domain, organization, password)
â”œâ”€â”€ Makefile                 # Automation for build, run, and cleanup
â””â”€â”€ README.md                # You're here
```

---

# ğŸš€ Usage

## ğŸ”§ Build the Docker image

```bash
make build VERSION=1.0.0
```

or manually:

```bash
docker build -t itcommunity/openldap-identity-prod:1.0.0 .
```

## â–¶ï¸ Run with Docker Compose

```bash
make up VERSION=1.0.0
```

or directly:

```bash
docker compose up -d
```

## ğŸ”„ Restart

```bash
make restart
```

## ğŸ§¼ Cleanup

```bash
make down
make clean
```

---

# ğŸ›  Configuration

| File / Path                                | Description                                      |
|--------------------------------------------|--------------------------------------------------|
| `bootstrap/entrypoint.sh`                  | Entry point script used for initial setup        |
| `secrets/ldap_admin_password`              | Mounted secret file with LDAP admin password     |
| `/var/lib/ldap` (via `ldap_data`)          | LDAP database directory (persistent)             |
| `/etc/ldap/slapd.d` (via `ldap_config`)    | LDAP configuration directory (persistent)        |
| `.env`                                     | LDAP domain and organization variables           |

### Environment Variables (via `.env`)

```ini
LDAP_DOMAIN=itcommunity.ro
LDAP_ORGANISATION=ITcommunity SRL
LDAP_ADMIN_PASSWORD=superpassword
```

---

# ğŸ”– Tagging & Versioning

We follow semantic versioning:

- `itcommunity/openldap-identity-prod:1.0.0` â€” stable version
- `itcommunity/openldap-identity-prod:prod` â€” alias for production
- `itcommunity/openldap-identity-prod:sha-<git-sha>` â€” Git-based immutable builds

Use `make tag` and `make push` to automate tagging and deployment:

```bash
make tag
make push
```

---

# ğŸ” Security Notes

- Secrets should be injected only through mounted files in `secrets/`
- Ensure `.env` and `secrets/` are excluded via `.gitignore`
- Do not expose ports `389` and `636` externally unless protected by a reverse proxy or firewall

---

# ğŸ‘¥ Contributors

**Owner:** [Itcommunity DevOps Team]  
**Maintainers:** [@alexandru-raul], [@infra-directory], [@ldap-admins]

---

# ğŸ“„ License

[MIT License](https://opensource.org/licenses/MIT)